<!DOCTYPE html>
<html dir="rtl" lang="ar" id="htmlElement">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Receipt System - Valencia Marble</title>
    <style>
        /* أنماط كلاسيكية احترافية مشابهة لنظام الأوامر الإدارية */
        @page {
            size: A4;
            margin: 0.3cm !important;
        }

        :root {
            --primary-color: #1a365d;
            --secondary-color: #c19a53;
            --accent-color: #2c5282;
            --light-color: #f8f9fa;
            --dark-color: #2d3748;
        }

        body {
            font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            color: #2d3748;
            font-size: 10pt;
            line-height: 1.5;
            transition: all 0.3s;
        }

        body.english-mode {
            direction: ltr;
            text-align: left;
        }

        body.english-mode .header,
        body.english-mode .document-info,
        body.english-mode .document-title,
        body.english-mode .company-name,
        body.english-mode .company-subtitle,
        body.english-mode .department {
            text-align: center !important;
        }

        .header {
            text-align: center;
            margin-bottom: 8px;
            padding: 5px 0 3px 0;
            border-bottom: 2px solid #c19a53;
            position: relative;
        }

        .company-name {
            font-size: 20pt;
            font-weight: bold;
            color: #1a365d;
            font-family: 'Times New Roman', serif;
            margin-bottom: 1px;
        }

        .company-subtitle {
            font-size: 14pt;
            color: #2c5282;
            font-family: 'Times New Roman', serif;
            margin-bottom: 3px;
            padding-top: 1px;
            border-top: 1px solid #c19a53;
        }

        .department {
            font-size: 12pt;
            color: #c19a53;
            font-weight: bold;
            margin: 3px 0 2px 0;
            font-family: 'Times New Roman', serif;
            padding: 2px;
        }

        .document-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 6px 0;
            padding: 5px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }

        .document-date {
            font-size: 9pt;
            color: #2d3748;
            font-weight: bold;
            flex: 1;
        }

        body:not(.english-mode) .document-date {
            text-align: right;
        }

        body.english-mode .document-date {
            text-align: left;
        }

        .document-title {
            text-align: center;
            font-size: 18pt;
            color: #1a365d;
            font-weight: bold;
            margin: 6px 0;
            font-family: 'Times New Roman', serif;
            padding: 4px;
            flex: 2;
        }

        .document-number {
            font-size: 11pt;
            color: #c19a53;
            font-weight: bold;
            text-align: center;
            padding: 3px 6px;
            border: 2px solid #c19a53;
            border-radius: 3px;
            background: white;
            display: inline-block;
            flex: 1;
        }

        body:not(.english-mode) .document-number {
            margin-left: 6px;
        }

        body.english-mode .document-number {
            margin-right: 6px;
        }

        .control-panel {
            background: linear-gradient(135deg, #1a365d, #2c5282);
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .language-toggle {
            background: linear-gradient(135deg, #9b2c2c, #c53030);
            color: white;
            border: 1px solid #9b2c2c;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s;
            font-size: 10pt;
            min-width: 130px;
            margin: 5px;
        }

        .language-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }

        .btn {
            padding: 6px 12px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s;
            font-size: 10pt;
            min-width: 130px;
            font-family: 'Times New Roman', serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }

        .btn-generate {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: white;
            border: 1px solid #2d3748;
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-print {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: 1px solid #27ae60;
        }

        .btn-reset {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            border: 1px solid #c53030;
        }

        .btn-reset-counter {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
            border: 1px solid #dd6b20;
        }

        textarea, input, select {
            border: 1px solid #cbd5e0;
            border-radius: 2px;
            padding: 4px 6px;
            font-size: 9.5pt;
            transition: all 0.3s;
            background: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            width: 100%;
            box-sizing: border-box;
            height: 28px;
        }

        textarea:focus, input:focus, select:focus {
            border-color: #2c5282;
            box-shadow: 0 0 0 1px rgba(44, 82, 130, 0.2);
            outline: none;
        }

        .receipt-text {
            min-height: 120px;
            height: 120px;
            font-size: 10.5pt;
            line-height: 1.6;
            padding: 6px;
            background: #f8f9fa;
            border: 1px solid #e2e8f0;
            border-radius: 3px;
            resize: vertical;
        }

        .signature-section {
            margin-top: 25px;
            padding-top: 8px;
            border-top: 2px solid #c19a53;
            background: #f8fafc;
            padding: 8px;
            border-radius: 4px;
        }

        .signature-box {
            border: 1px solid #cbd5e0;
            padding: 6px;
            height: 85px;
            border-radius: 3px;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        .signature-line {
            border-bottom: 1px solid #2d3748;
            margin-top: 8px;
            padding-bottom: 2px;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        .signature-box strong {
            font-size: 9.5pt;
            color: #1a365d;
            font-family: 'Times New Roman', serif;
            margin-bottom: 4px;
            display: block;
            text-align: center;
        }

        .signature-box div {
            font-size: 7.5pt;
            margin-top: 1px;
            color: #4a5568;
            text-align: center;
        }

        .signature-box i.fa-stamp {
            font-size: 16pt;
            color: #c19a53;
            margin-top: 2px;
            opacity: 0.9;
            text-align: center;
            display: block;
        }

        .document-content {
            background: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 12px;
        }

        .receipt-intro {
            font-size: 10.5pt;
            text-align: justify;
            line-height: 1.6;
            margin: 6px 0;
            padding: 5px;
            background: #f8f9fa;
            border-radius: 3px;
        }

        body:not(.english-mode) .receipt-intro {
            border-right: 2px solid #c19a53;
        }

        body.english-mode .receipt-intro {
            border-left: 2px solid #c19a53;
        }

        @media print {
            /* تحسين الهوامش لاستخدام أفضل للمساحة */
            @page {
                size: A4 portrait;
                margin: 0.8cm 1cm !important;
            }

            body {
                font-size: 10pt !important;
                line-height: 1.5 !important;
                background: white !important;
                color: black !important;
                margin: 0 !important;
                padding: 0 !important;
                direction: rtl !important;
                text-align: right !important;
            }

            /* تحسين توزيع الرأس الثابت */
            .print-header {
                position: fixed !important;
                top: 0.8cm !important;
                left: 1cm !important;
                right: 1cm !important;
                height: 2.5cm !important;
                z-index: 9999 !important;
                background: white !important;
                border-bottom: 2px solid #000 !important;
                padding-bottom: 5px !important;
                page-break-inside: avoid !important;
            }

            .print-header .company-name {
                font-size: 16pt !important;
                margin: 2px 0 !important;
                padding: 0 !important;
            }

            .print-header .company-subtitle {
                font-size: 9pt !important;
                margin: 1px 0 !important;
                padding: 0 !important;
            }

            .print-header .department {
                font-size: 8pt !important;
                margin: 1px 0 3px 0 !important;
                padding: 0 !important;
            }

            .print-header .document-info {
                padding: 2px 3px !important;
                margin: 3px 0 0 0 !important;
            }

            .print-header .document-title {
                font-size: 11pt !important;
                padding: 0 5px !important;
            }

            .print-header .document-number {
                font-size: 8pt !important;
                padding: 1px 4px !important;
                min-width: 70px !important;
            }

            .print-header .document-date {
                font-size: 8pt !important;
                padding: 0 5px !important;
            }

            /* المحتوى الرئيسي - يبدأ بعد الرأس الثابت */
            .content-container {
                margin: 3cm 0 2cm 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                background: none !important;
                page-break-inside: avoid !important;
                min-height: calc(100vh - 5cm) !important;
            }

            /* تحسين توزيع صفوف المعلومات */
            .info-row {
                display: flex !important;
                margin-bottom: 4px !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            .info-item {
                flex: 1 !important;
                min-width: 120px !important;
                margin-bottom: 3px !important;
                padding: 0 2px !important;
            }

            .info-item label {
                font-size: 7.5pt !important;
                margin-bottom: 1px !important;
                font-weight: bold !important;
            }

            .info-item input, 
            .info-item select {
                font-size: 8pt !important;
                height: 18px !important;
                padding: 0 2px !important;
                border-bottom: 1px solid #ccc !important;
                border-top: none !important;
                border-left: none !important;
                border-right: none !important;
                background: none !important;
                width: 100% !important;
            }

            /* تحسين منطقة نص المحضر */
            .receipt-intro {
                margin: 8px 0 !important;
                padding: 5px !important;
                font-size: 9pt !important;
                line-height: 1.4 !important;
                border: 1px solid #000 !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            .receipt-text {
                min-height: 100px !important;
                height: auto !important;
                max-height: 150px !important;
                font-size: 9pt !important;
                line-height: 1.4 !important;
                padding: 5px !important;
                margin: 8px 0 !important;
                border: 1px solid #000 !important;
                overflow: hidden !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            /* إدارة الارتفاع التلقائي للنص */
            .arabic-section {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                margin-bottom: 10px !important;
            }

            /* تحسين منطقة التواقيع */
            .signature-section {
                margin-top: 15px !important;
                padding-top: 8px !important;
                border-top: 2px solid #000 !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                position: relative !important;
            }

            .signature-box {
                height: 60px !important;
                padding: 3px !important;
                margin-bottom: 5px !important;
            }

            .signature-box strong {
                font-size: 8pt !important;
            }

            .signature-box div {
                font-size: 6.5pt !important;
            }

            .signature-line {
                margin-top: 2px !important;
                margin-bottom: 1px !important;
                width: 85% !important;
            }

            /* تذييل الطباعة المحسن */
            .print-footer {
                position: fixed !important;
                bottom: 0.8cm !important;
                left: 1cm !important;
                right: 1cm !important;
                height: 1.5cm !important;
                z-index: 9999 !important;
                background: white !important;
                border-top: 1px solid #000 !important;
                padding: 2px 0 !important;
                font-size: 6.5pt !important;
            }

            .print-footer-content {
                padding: 0 5px !important;
                line-height: 1.2 !important;
            }

            /* منع انقسام العناصر المهمة */
            .no-break {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            /* إخفاء النسخة الإنجليزية نهائياً عند الطباعة */
            .english-section {
                display: none !important;
            }

            /* إظهار النسخة العربية فقط */
            .arabic-section {
                display: block !important;
            }

            /* تحسين عرض النصوص الطويلة */
            .receipt-text {
                white-space: pre-line !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }

            /* ضبط أقصى ارتفاع للمحتوى ليتناسب مع صفحة واحدة */
            .document-content {
                max-height: calc(100vh - 6cm) !important;
                overflow: hidden !important;
            }
        }

        @media (max-width: 768px) {
            .btn, .language-toggle { min-width: 110px; padding: 4px 6px; font-size: 9pt; }
            .control-panel { padding: 8px; }

            .company-name {
                font-size: 16pt;
            }

            .company-subtitle {
                font-size: 10pt;
            }

            .department {
                font-size: 9pt;
            }

            .document-title {
                font-size: 14pt;
            }

            .document-info {
                flex-direction: column;
                gap: 4px;
            }

            .signature-box {
                height: 75px;
                padding: 5px;
            }
        }

        /* تنسيقات إضافية */
        .info-row {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
            flex-wrap: wrap;
        }

        .info-item {
            flex: 1;
            min-width: 150px;
        }

        .info-item label {
            display: block;
            margin-bottom: 2px;
            font-weight: bold;
            color: #2c5282;
            font-size: 9pt;
        }

        .serial-display {
            background: rgba(255,255,255,0.1);
            padding: 4px 8px;
            border-radius: 2px;
            margin-top: 6px;
            font-size: 9pt;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .auto-calculation-note {
            font-size: 7.5pt;
            color: #718096;
            text-align: center;
            margin-top: 4px;
            font-style: italic;
        }

        .content-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 8px;
            border-radius: 5px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        /* تصميم مضغوط */
        .compact-field {
            margin: 0 !important;
            padding: 2px 4px !important;
        }

        .no-break {
            page-break-inside: avoid;
        }

        /* نافذة الإشعار التلقائي */
        #auto-send-notification {
            position: fixed;
            bottom: 15px;
            left: 15px;
            padding: 8px 12px;
            border-radius: 4px;
            z-index: 10000;
            font-size: 9.5pt;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            max-width: 300px;
            animation: slideIn 0.5s ease-out;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid;
        }

        #auto-send-notification.success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        #auto-send-notification.error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        #auto-send-notification.info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }

        #auto-send-notification.sending {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* نافذة التأكيد */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .confirmation-content {
            background: white;
            padding: 12px;
            border-radius: 4px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
        }

        .confirmation-content h3 {
            color: #1a365d;
            margin-bottom: 8px;
            font-family: 'Times New Roman', serif;
            font-size: 11pt;
        }

        .confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #38a169, #2f855a);
            color: white;
            padding: 4px 12px;
            border-radius: 2px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 9pt;
        }

        .btn-cancel {
            background: linear-gradient(135deg, #a0aec0, #718096);
            color: white;
            padding: 4px 12px;
            border-radius: 2px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 9pt;
        }

        /* تصميم حقل الإدخال مع قائمة الإكمال التلقائي */
        .employee-input-container {
            position: relative;
            width: 100%;
        }

        .employee-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #cbd5e0;
            border-top: none;
            border-radius: 0 0 3px 3px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .employee-suggestion-item {
            padding: 6px 8px;
            cursor: pointer;
            font-size: 9.5pt;
            transition: background-color 0.2s;
            border-bottom: 1px solid #f1f5f9;
        }

        .employee-suggestion-item:last-child {
            border-bottom: none;
        }

        .employee-suggestion-item:hover,
        .employee-suggestion-item.active {
            background-color: #f7fafc;
            color: #2c5282;
        }

        .employee-suggestion-item.new-employee {
            color: #c53030;
            font-weight: bold;
            background-color: #fff5f5;
        }

        .employee-suggestion-item.new-employee:before {
            content: "+ ";
            color: #38a169;
        }

        .employee-input-container input {
            width: 100%;
        }

        .employee-add-notice {
            font-size: 7.5pt;
            color: #718096;
            margin-top: 2px;
            display: block;
            text-align: right;
            font-style: italic;
        }

        body.english-mode .employee-add-notice {
            text-align: left;
        }

        /* مؤشر التحميل */
        .auto-generate-indicator {
            background: linear-gradient(135deg, #2c5282, #1a365d);
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 8pt;
            margin-left: 5px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            animation: pulse 1.5s infinite;
        }

        body.english-mode .auto-generate-indicator {
            margin-left: 0;
            margin-right: 5px;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        /* رأس الطباعة المخفي للعرض العادي */
        .print-header, .print-footer {
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- لوحة التحكم -->
    <div class="control-panel no-print">
        <div style="text-align: center; margin-bottom: 6px;">
            <h2 style="margin: 0 0 3px 0; font-family: 'Times New Roman', serif; font-size: 11pt;">
                <i class="fas fa-car"></i> نظام محاضر استلام السيارات
                <span class="auto-generate-indicator">
                    <i class="fas fa-sync-alt"></i> إنشاء تلقائي
                </span>
            </h2>
            <h4 style="margin: 0; font-weight: normal; opacity: 0.9; font-family: 'Times New Roman', serif; font-size: 9.5pt;">
                شركة فالنسيا لتجارة الرخام والحجر الطبيعي
            </h4>
        </div>

        <div style="text-align: center;">
            <button class="btn btn-print" onclick="printReceipt()">
                <i class="fas fa-print"></i> طباعة المحضر
            </button>
            <button class="btn btn-reset" onclick="resetForm()">
                <i class="fas fa-redo"></i> تفريغ الحقول
            </button>
            <button class="btn btn-reset-counter" onclick="resetCounter()">
                <i class="fas fa-history"></i> إعادة ضبط الترقيم
            </button>
            <button class="language-toggle" onclick="toggleLanguage()">
                <i class="fas fa-language"></i> <span id="languageToggleText">English Version</span>
            </button>
        </div>

        <div class="auto-calculation-note">
            <i class="fas fa-info-circle"></i> <span id="autoGenerateNote">يتم إنشاء المحضر تلقائياً عند إدخال اسم المستلم</span>
        </div>
    </div>

    <!-- رأس الطباعة الثابت -->
    <div class="print-header">
        <div class="company-name" id="printCompanyName">فالنسيا لتجارة الرخام والحجر الطبيعي</div>
        <div class="company-subtitle" id="printCompanySubtitle">شركة مساهمة خاصة - دبي</div>
        <div class="department" id="printDepartment">إدارة النقل والخدمات اللوجستية</div>
        
        <div class="document-info">
            <div class="document-date" id="print-current-date">--/--/----</div>
            <div class="document-title" id="printDocumentTitle">محضر استلام سيارة</div>
            <div class="document-number" id="print-serial-number">REC-000001</div>
        </div>
    </div>

    <!-- نموذج محضر استلام السيارة -->
    <div class="content-container no-break">
        <div class="document-info no-print">
            <div class="document-date" id="current-date">--/--/----</div>
            <div class="document-title" id="documentTitle">محضر استلام سيارة</div>
            <div style="text-align: center; flex: 1;">
                <div style="font-size: 8pt; color: #4a5568; margin-bottom: 1px;" id="documentNumberLabel">رقم</div>
                <div class="document-number" id="serial-number">REC-000001</div>
            </div>
        </div>

        <div class="document-content">
            <!-- معلومات محضر الاستلام -->
            <div class="info-row no-break">
                <div class="info-item">
                    <label for="receiverName" id="receiverNameLabel">اسم المستلم:</label>
                    <div class="employee-input-container">
                        <input type="text" id="receiverName" placeholder="أدخل اسم المستلم" class="print-field compact-field">
                    </div>
                    <span class="employee-add-notice" id="autoGenerateNotice">يتم إنشاء المحضر تلقائياً عند الإدخال</span>
                </div>

                <div class="info-item">
                    <label for="receiptDate" id="receiptDateLabel">تاريخ المحضر:</label>
                    <input type="date" id="receiptDate" class="print-field compact-field">
                </div>

                <div class="info-item">
                    <label for="receiveDate" id="receiveDateLabel">تاريخ الاستلام:</label>
                    <input type="date" id="receiveDate" class="print-field compact-field">
                </div>
            </div>

            <div class="info-row no-break">
                <div class="info-item">
                    <label for="companyName" id="companyNameLabel">اسم الشركة:</label>
                    <input type="text" id="companyName" value="فالنسيا لتجارة الرخام والحجر الطبيعي" class="print-field compact-field">
                </div>

                <div class="info-item">
                    <label for="vehicleClass" id="vehicleClassLabel">صنف المركبة:</label>
                    <select id="vehicleClass" class="print-field compact-field">
                        <option value="فان ركاب">فان ركاب</option>
                        <option value="باص مشاريع">باص مشاريع</option>
                        <option value="سيارة نقل">سيارة نقل</option>
                        <option value="سيارة خاصة">سيارة خاصة</option>
                        <option value="شاحنة">شاحنة</option>
                        <option value="معدات ثقيلة">معدات ثقيلة</option>
                    </select>
                </div>

                <div class="info-item">
                    <label for="vehicleType" id="vehicleTypeLabel">نوع المركبة:</label>
                    <input type="text" id="vehicleType" value="HYUNDAI STAREX" class="print-field compact-field">
                </div>
            </div>

            <div class="info-row no-break">
                <div class="info-item">
                    <label for="manufactureYear" id="manufactureYearLabel">سنة الصنع:</label>
                    <input type="number" id="manufactureYear" value="2012" min="1990" max="2025" class="print-field compact-field">
                </div>

                <div class="info-item">
                    <label for="vehicleColor" id="vehicleColorLabel">لون المركبة:</label>
                    <select id="vehicleColor" class="print-field compact-field">
                        <option value="رمادي">رمادي</option>
                        <option value="أسود">أسود</option>
                        <option value="أبيض">أبيض</option>
                        <option value="فضي">فضي</option>
                        <option value="أزرق">أزرق</option>
                        <option value="أحمر">أحمر</option>
                        <option value="أخضر">أخضر</option>
                        <option value="بني">بني</option>
                        <option value="ذهبي">ذهبي</option>
                        <option value="أصفر">أصفر</option>
                    </select>
                </div>

                <div class="info-item">
                    <label for="chassisNumber" id="chassisNumberLabel">رقم القاعدة (الشاسيه):</label>
                    <input type="text" id="chassisNumber" value="KMJWA37KBCU482534" class="print-field compact-field">
                </div>
            </div>

            <div class="info-row no-break">
                <div class="info-item">
                    <label for="plateNumber" id="plateNumberLabel">رقم اللوحات:</label>
                    <input type="text" id="plateNumber" value="FF-35715" class="print-field compact-field">
                </div>

                <div class="info-item">
                    <label for="plateEmirate" id="plateEmirateLabel">إمارة اللوحات:</label>
                    <select id="plateEmirate" class="print-field compact-field">
                        <option value="">اختر الإمارة</option>
                        <option value="أبو ظبي">أبو ظبي</option>
                        <option value="دبي">دبي</option>
                        <option value="الشارقة">الشارقة</option>
                        <option value="عجمان">عجمان</option>
                        <option value="أم القيوين">أم القيوين</option>
                        <option value="رأس الخيمة">رأس الخيمة</option>
                        <option value="الفجيرة">الفجيرة</option>
                        <option value="مشترك">مشترك</option>
                    </select>
                </div>

                <div class="info-item">
                    <label for="vehicleCondition" id="vehicleConditionLabel">حالة المركبة:</label>
                    <select id="vehicleCondition" class="print-field compact-field">
                        <option value="جيدة">جيدة</option>
                        <option value="جيدة جداً">جيدة جداً</option>
                        <option value="ممتازة">ممتازة</option>
                        <option value="تحتاج صيانة">تحتاج صيانة</option>
                        <option value="صيانة بسيطة">صيانة بسيطة</option>
                    </select>
                </div>
            </div>

            <!-- منطقة العرض ثنائية اللغة -->
            <div id="receiptDisplay" style="display: none;">
                <!-- النسخة العربية - تظهر دائماً في الطباعة -->
                <div class="arabic-section no-break">
                    <div style="margin-top: 15px;">
                        <h5 style="text-align: center; color: #1a365d; font-family: 'Times New Roman', serif; margin-bottom: 5px; font-size: 11pt;">
                            محضر استلام سيارة
                        </h5>
                        <div class="receipt-text print-field" id="arabicReceiptDetails">
                            <!-- سيتم تعبئته ديناميكياً -->
                        </div>
                    </div>
                </div>

                <!-- النسخة الإنجليزية - تظهر فقط على الشاشة -->
                <div class="english-section no-print" style="margin-top: 15px; border-top: 1px solid #e2e8f0; padding-top: 10px;">
                    <h5 style="text-align: center; color: #2c5282; font-family: 'Arial', sans-serif; margin-bottom: 5px; font-size: 10pt;">
                        Vehicle Receipt Form (English Version)
                    </h5>
                    <div class="receipt-text" id="englishReceiptDetails" style="background: #f0f7ff; font-family: 'Arial', sans-serif;">
                        <!-- سيتم تعبئته ديناميكياً -->
                    </div>
                </div>

                <!-- التواقيع -->
                <div class="signature-section no-break">
                    <div style="text-align: center; margin-bottom: 6px; font-weight: bold; font-size: 9.5pt; color: #1a365d;" id="signaturesTitle">
                        تواقيع طرفي المحضر
                    </div>

                    <div style="display: flex; gap: 6px;">
                        <div style="flex: 1;">
                            <div class="signature-box">
                                <strong id="receiverSignatureLabel">توقيع المستلم</strong>
                                <div class="signature-line"></div>
                                <div id="signatureReceiverName"></div>
                                <div id="signatureDate"></div>
                            </div>
                        </div>

                        <div style="flex: 1;">
                            <div class="signature-box">
                                <strong id="companySignatureLabel">توقيع ممثل الشركة</strong>
                                <div style="margin-top: 1px; font-size: 1pt; color: #c19a53;">
                                    <i class="fas fa-stamp"></i>
                                </div>
                                <div id="companyNameStamp">شركة فالنسيا للرخام</div>
                                <div id="companyRepresentative"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- تذييل الطباعة الثابت -->
    <div class="print-footer">
        <div class="print-footer-content">
            <div style="margin-bottom: 3px;">
                <strong id="footerCompanyName">شركة فالنسيا لتجارة الرخام والحجر الطبيعي</strong> | 
                <span id="footerAddress">ص.ب: XXXXX | هاتف: +971 X XXX XXXX</span>
            </div>
            <div style="font-size: 6pt; color: #666;">
                <span id="footerNote">هذا المحضر صادر من النظام الإلكتروني لإدارة السيارات | جميع الحقوق محفوظة ©</span> 
                <span id="current-year"></span>
            </div>
        </div>
    </div>

    <!-- نافذة التأكيد -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-content">
            <!-- سيتم تعبئته ديناميكياً -->
        </div>
    </div>

    <!-- نافذة الإشعار التلقائي -->
    <div id="auto-send-notification" style="display: none;"></div>

    <script>
        // =============================================
        // متغيرات النظام
        // =============================================

        let currentReceiptNumber = 1;
        let savedReceivers = [];
        let receiptGenerated = false;
        let autoGenerateTimeout = null;
        let currentLanguage = 'ar'; // 'ar' أو 'en'

        // نصوص ثنائية اللغة
        const translations = {
            ar: {
                // رأس النظام
                systemTitle: "نظام محاضر استلام السيارات",
                companyName: "شركة فالنسيا لتجارة الرخام والحجر الطبيعي",
                
                // أزرار التحكم
                printBtn: "طباعة المحضر",
                resetBtn: "تفريغ الحقول",
                resetCounterBtn: "إعادة ضبط الترقيم",
                switchToEnglish: "English Version",
                
                // ملاحظات
                autoGenerateNote: "يتم إنشاء المحضر تلقائياً عند إدخال اسم المستلم",
                autoGenerateNotice: "يتم إنشاء المحضر تلقائياً عند الإدخال",
                
                // عناوين المحضر
                documentTitle: "محضر استلام سيارة",
                documentNumber: "رقم",
                receiptDateLabel: "تاريخ المحضر:",
                receiveDateLabel: "تاريخ الاستلام:",
                receiverNameLabel: "اسم المستلم:",
                companyNameLabel: "اسم الشركة:",
                vehicleClassLabel: "صنف المركبة:",
                vehicleTypeLabel: "نوع المركبة:",
                manufactureYearLabel: "سنة الصنع:",
                vehicleColorLabel: "لون المركبة:",
                chassisNumberLabel: "رقم القاعدة (الشاسيه):",
                plateNumberLabel: "رقم اللوحات:",
                plateEmirateLabel: "إمارة اللوحات:",
                vehicleConditionLabel: "حالة المركبة:",
                
                // نصوص المحضر العربي
                arabicReceiptText: function(data) {
                    return `\nأقر أنا ${data.receiverName} باستلام ${data.vehicleClass} خاص بشركة ${data.companyName} بالمواصفات التالية:\n\n` +
                           `• صنف المركبة: ${data.vehicleClass}\n` +
                           `• نوع المركبة: ${data.vehicleType}\n` +
                           `• سنة الصنع: ${data.manufactureYear}\n` +
                           `• لون المركبة: ${data.vehicleColor}\n` +
                           `• رقم القاعدة (الشاسيه): ${data.chassisNumber}\n` +
                           `• رقم اللوحات: ${data.plateNumber} ${data.plateEmirate ? `(${data.plateEmirate})` : ''}\n` +
                           `• حالة المركبة: ${data.vehicleCondition}\n\n` +
                           `وتم استلام المركبة ابتداءً من تاريخ ${data.receiveDate}، وأصبحت مسؤولاً عنها مسؤولية تامة عن أي مخالفات مرورية أو حوادث أو تلف يلحق بالمركبة نتيجة إهمال شخصي أثناء فترة حيازتي لها، وتصبح الشركة غير مسؤولة عن ذلك.\n\n` +
                           `التاريخ: ${data.receiptDate}`;
                },
                
                // التواقيع
                signaturesTitle: "تواقيع طرفي المحضر",
                receiverSignatureLabel: "توقيع المستلم",
                companySignatureLabel: "توقيع ممثل الشركة",
                companyStamp: "شركة فالنسيا للرخام",
                companyRepresentative: "مدير العمليات",
                
                // التذييل
                footerCompany: "شركة فالنسيا لتجارة الرخام والحجر الطبيعي",
                footerAddress: "ص.ب: XXXXX | هاتف: +971 X XXX XXXX",
                footerNote: "هذا المحضر صادر من النظام الإلكتروني لإدارة السيارات | جميع الحقوق محفوظة ©",
                
                // رسائل الإشعار
                receiptGenerated: (num) => `✅ تم إنشاء المحضر تلقائياً برقم REC-${num.toString().padStart(6, '0')}`,
                fieldsCleared: "✅ تم تفريغ جميع الحقول بنجاح",
                counterReset: "✅ تم إعادة ضبط الترقيم بنجاح",
                receiverAdded: (name) => `✅ تم إضافة "${name}" إلى قائمة المستلمين`,
                enterReceiverFirst: "❌ يرجى إدخال اسم المستلم أولاً",
                
                // رسائل التأكيد
                confirmResetFields: "هل أنت متأكد من تفريغ جميع الحقول؟ سيتم فقدان المحضر الحالي.",
                confirmResetCounter: "هل أنت متأكد من إعادة ضبط ترقيم المحاضر إلى 1؟",
                
                // رأس الطباعة
                printCompanyName: "فالنسيا لتجارة الرخام والحجر الطبيعي",
                printCompanySubtitle: "شركة مساهمة خاصة - دبي",
                printDepartment: "إدارة النقل والخدمات اللوجستية"
            },
            
            en: {
                // رأس النظام
                systemTitle: "Vehicle Receipt System",
                companyName: "Valencia Marble & Natural Stone Trading Co.",
                
                // أزرار التحكم
                printBtn: "Print Receipt",
                resetBtn: "Clear Fields",
                resetCounterBtn: "Reset Counter",
                switchToEnglish: "Arabic Version",
                
                // ملاحظات
                autoGenerateNote: "Receipt is automatically generated when entering receiver name",
                autoGenerateNotice: "Receipt is automatically generated on input",
                
                // عناوين المحضر
                documentTitle: "Vehicle Receipt Form",
                documentNumber: "No.",
                receiptDateLabel: "Receipt Date:",
                receiveDateLabel: "Receive Date:",
                receiverNameLabel: "Receiver Name:",
                companyNameLabel: "Company Name:",
                vehicleClassLabel: "Vehicle Class:",
                vehicleTypeLabel: "Vehicle Type:",
                manufactureYearLabel: "Manufacture Year:",
                vehicleColorLabel: "Vehicle Color:",
                chassisNumberLabel: "Chassis Number:",
                plateNumberLabel: "Plate Number:",
                plateEmirateLabel: "Plate Emirate:",
                vehicleConditionLabel: "Vehicle Condition:",
                
                // نصوص المحضر الإنجليزي
                englishReceiptText: function(data) {
                    return `\nI, ${data.receiverName}, hereby acknowledge receipt of a ${data.vehicleClass.toLowerCase()} from ${data.companyName} with the following specifications:\n\n` +
                           `• Vehicle Class: ${data.vehicleClass}\n` +
                           `• Vehicle Type: ${data.vehicleType}\n` +
                           `• Manufacture Year: ${data.manufactureYear}\n` +
                           `• Vehicle Color: ${data.vehicleColor}\n` +
                           `• Chassis Number: ${data.chassisNumber}\n` +
                           `• Plate Number: ${data.plateNumber} ${data.plateEmirate ? `(${data.plateEmirate})` : ''}\n` +
                           `• Vehicle Condition: ${data.vehicleCondition}\n\n` +
                           `The vehicle was received starting from ${data.receiveDate}. I am fully responsible for any traffic violations, accidents, or damage to the vehicle resulting from personal negligence during my possession of the vehicle, and the company is not responsible for such incidents.\n\n` +
                           `Date: ${data.receiptDate}`;
                },
                
                // التواقيع
                signaturesTitle: "Signatures of Both Parties",
                receiverSignatureLabel: "Receiver's Signature",
                companySignatureLabel: "Company Representative Signature",
                companyStamp: "Valencia Marble Co.",
                companyRepresentative: "Operations Manager",
                
                // التذييل
                footerCompany: "Valencia Marble & Natural Stone Trading Co.",
                footerAddress: "P.O. Box: XXXXX | Phone: +971 X XXX XXXX",
                footerNote: "This receipt is issued from the Electronic Vehicle Management System | All rights reserved ©",
                
                // رسائل الإشعار
                receiptGenerated: (num) => `✅ Receipt automatically generated with number REC-${num.toString().padStart(6, '0')}`,
                fieldsCleared: "✅ All fields cleared successfully",
                counterReset: "✅ Counter reset successfully",
                receiverAdded: (name) => `✅ "${name}" added to receivers list`,
                enterReceiverFirst: "❌ Please enter receiver name first",
                
                // رسائل التأكيد
                confirmResetFields: "Are you sure you want to clear all fields? Current receipt will be lost.",
                confirmResetCounter: "Are you sure you want to reset receipt counter to 1?",
                
                // رأس الطباعة
                printCompanyName: "Valencia Marble & Natural Stone Trading",
                printCompanySubtitle: "Private Joint Stock Company - Dubai",
                printDepartment: "Transport & Logistics Department"
            }
        };

        // =============================================
        // تهيئة الصفحة
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            // تعيين السنة الحالية للتذييل
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // تعيين التواريخ الحالية
            setCurrentDate();
            setDefaultDates();
            
            // تحميل البيانات المحفوظة
            loadSavedData();
            loadSavedReceivers();
            
            // تحديث رقم المحضر
            updateReceiptNumber();
            
            // تعيين اللغة من التخزين المحلي
            const savedLang = localStorage.getItem('valenciaLanguage');
            if (savedLang) {
                currentLanguage = savedLang;
                applyLanguage();
            }
            
            // إضافة مستمعات الأحداث
            document.querySelectorAll('.print-field').forEach(field => {
                field.addEventListener('input', function() {
                    saveData();
                    // تحديث رأس الطباعة
                    updatePrintHeader();
                    // تشغيل الإنشاء التلقائي بعد 2 ثانية من التوقف عن الكتابة
                    startAutoGenerate();
                });
                field.addEventListener('change', function() {
                    saveData();
                    updatePrintHeader();
                    startAutoGenerate();
                });
            });
            
            // تفعيل الإدخال التلقائي لأسماء المستلمين
            initReceiverAutocomplete();
        });

        // =============================================
        // دوال إدارة اللغة
        // =============================================

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            localStorage.setItem('valenciaLanguage', currentLanguage);
            applyLanguage();
        }

        function applyLanguage() {
            const t = translations[currentLanguage];
            const body = document.body;
            
            // تغيير اتجاه الصفحة
            if (currentLanguage === 'ar') {
                body.classList.remove('english-mode');
                body.dir = 'rtl';
                body.lang = 'ar';
                document.documentElement.dir = 'rtl';
                document.documentElement.lang = 'ar';
            } else {
                body.classList.add('english-mode');
                body.dir = 'ltr';
                body.lang = 'en';
                document.documentElement.dir = 'ltr';
                document.documentElement.lang = 'en';
            }
            
            // تحديث النصوص
            updateAllTexts(t);
            
            // إعادة إنشاء المحضر إذا كان موجوداً
            if (receiptGenerated) {
                setTimeout(() => {
                    autoGenerateReceipt();
                }, 100);
            }
        }

        function updateAllTexts(t) {
            // تحديث أزرار التحكم
            document.querySelector('.btn-print').innerHTML = `<i class="fas fa-print"></i> ${t.printBtn}`;
            document.querySelector('.btn-reset').innerHTML = `<i class="fas fa-redo"></i> ${t.resetBtn}`;
            document.querySelector('.btn-reset-counter').innerHTML = `<i class="fas fa-history"></i> ${t.resetCounterBtn}`;
            document.getElementById('languageToggleText').textContent = t.switchToEnglish;
            
            // تحديث الملاحظات
            document.getElementById('autoGenerateNote').textContent = t.autoGenerateNote;
            document.getElementById('autoGenerateNotice').textContent = t.autoGenerateNotice;
            
            // تحديث العناوين
            document.getElementById('documentTitle').textContent = t.documentTitle;
            document.getElementById('printDocumentTitle').textContent = t.documentTitle;
            document.getElementById('documentNumberLabel').textContent = t.documentNumber;
            
            // تحديث تسميات الحقول
            document.getElementById('receiptDateLabel').textContent = t.receiptDateLabel;
            document.getElementById('receiveDateLabel').textContent = t.receiveDateLabel;
            document.getElementById('receiverNameLabel').textContent = t.receiverNameLabel;
            document.getElementById('companyNameLabel').textContent = t.companyNameLabel;
            document.getElementById('vehicleClassLabel').textContent = t.vehicleClassLabel;
            document.getElementById('vehicleTypeLabel').textContent = t.vehicleTypeLabel;
            document.getElementById('manufactureYearLabel').textContent = t.manufactureYearLabel;
            document.getElementById('vehicleColorLabel').textContent = t.vehicleColorLabel;
            document.getElementById('chassisNumberLabel').textContent = t.chassisNumberLabel;
            document.getElementById('plateNumberLabel').textContent = t.plateNumberLabel;
            document.getElementById('plateEmirateLabel').textContent = t.plateEmirateLabel;
            document.getElementById('vehicleConditionLabel').textContent = t.vehicleConditionLabel;
            
            // تحديث التواقيع
            document.getElementById('signaturesTitle').textContent = t.signaturesTitle;
            document.getElementById('receiverSignatureLabel').textContent = t.receiverSignatureLabel;
            document.getElementById('companySignatureLabel').textContent = t.companySignatureLabel;
            document.getElementById('companyNameStamp').textContent = t.companyStamp;
            
            // تحديث التذييل
            document.getElementById('footerCompanyName').textContent = t.footerCompany;
            document.getElementById('footerAddress').textContent = t.footerAddress;
            document.getElementById('footerNote').textContent = t.footerNote;
            
            // تحديث رأس الطباعة
            document.getElementById('printCompanyName').textContent = t.printCompanyName;
            document.getElementById('printCompanySubtitle').textContent = t.printCompanySubtitle;
            document.getElementById('printDepartment').textContent = t.printDepartment;
            
            // تحديث placeholder
            document.getElementById('receiverName').placeholder = currentLanguage === 'ar' ? 'أدخل اسم المستلم' : 'Enter receiver name';
        }

        function setCurrentDate() {
            const now = new Date();
            const day = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear();
            const dateStr = `${day}-${month}-${year}`;

            document.getElementById('current-date').textContent = dateStr;
            document.getElementById('print-current-date').textContent = dateStr;
        }

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];

            document.getElementById('receiptDate').value = today;
            document.getElementById('receiveDate').value = tomorrowStr;
        }

        // تحديث رقم المحضر
        function updateReceiptNumber() {
            const savedNumber = localStorage.getItem('valenciaReceiptCounter');
            if (savedNumber) {
                currentReceiptNumber = parseInt(savedNumber);
            }
            const serialNum = `REC-${currentReceiptNumber.toString().padStart(6, '0')}`;
            document.getElementById('serial-number').textContent = serialNum;
            document.getElementById('print-serial-number').textContent = serialNum;
        }

        // زيادة رقم المحضر
        function incrementReceiptNumber() {
            currentReceiptNumber++;
            localStorage.setItem('valenciaReceiptCounter', currentReceiptNumber);
            updateReceiptNumber();
            return currentReceiptNumber;
        }

        // تحديث رأس الطباعة
        function updatePrintHeader() {
            // يمكن إضافة المزيد من البيانات هنا إذا لزم الأمر
        }

        // =============================================
        // الإنشاء التلقائي للمحضر
        // =============================================

        function startAutoGenerate() {
            // إلغاء المهلة السابقة إذا كانت موجودة
            if (autoGenerateTimeout) {
                clearTimeout(autoGenerateTimeout);
            }
            
            // ضبط مهلة جديدة للإنشاء التلقائي
            autoGenerateTimeout = setTimeout(function() {
                const receiverName = document.getElementById('receiverName').value.trim();
                
                if (receiverName && receiverName.length > 2) {
                    autoGenerateReceipt();
                }
            }, 2000); // انتظار ثانيتين بعد التوقف عن الكتابة
        }

        function autoGenerateReceipt() {
            const receiverName = document.getElementById('receiverName').value.trim();
            
            if (!receiverName || receiverName.length < 3) {
                return;
            }

            // إضافة المستلم للقائمة
            addReceiver(receiverName);

            // زيادة رقم المحضر (فقط إذا لم يكن المحضر مولداً بالفعل)
            if (!receiptGenerated) {
                incrementReceiptNumber();
            }

            // جمع البيانات
            const receiptDate = document.getElementById('receiptDate').value;
            const receiveDate = document.getElementById('receiveDate').value;
            const companyName = document.getElementById('companyName').value;
            const vehicleClass = document.getElementById('vehicleClass').value;
            const vehicleType = document.getElementById('vehicleType').value;
            const manufactureYear = document.getElementById('manufactureYear').value;
            const vehicleColor = document.getElementById('vehicleColor').value;
            const chassisNumber = document.getElementById('chassisNumber').value;
            const plateNumber = document.getElementById('plateNumber').value;
            const plateEmirate = document.getElementById('plateEmirate').value;
            const vehicleCondition = document.getElementById('vehicleCondition').value;

            // تنسيق التواريخ
            const formattedReceiptDate = formatDate(receiptDate);
            const formattedReceiveDate = formatDate(receiveDate);

            // إنشاء نص المحضر العربي
            const t = translations.ar;
            const arabicData = {
                receiverName: receiverName,
                vehicleClass: vehicleClass,
                companyName: companyName,
                vehicleType: vehicleType,
                manufactureYear: manufactureYear,
                vehicleColor: vehicleColor,
                chassisNumber: chassisNumber,
                plateNumber: plateNumber,
                plateEmirate: plateEmirate,
                vehicleCondition: vehicleCondition,
                receiveDate: formattedReceiveDate,
                receiptDate: formattedReceiptDate
            };

            const arabicText = t.arabicReceiptText(arabicData);

            // إنشاء نص المحضر الإنجليزي
            const e = translations.en;
            const englishData = {
                receiverName: receiverName,
                vehicleClass: vehicleClass,
                companyName: companyName,
                vehicleType: vehicleType,
                manufactureYear: manufactureYear,
                vehicleColor: vehicleColor,
                chassisNumber: chassisNumber,
                plateNumber: plateNumber,
                plateEmirate: plateEmirate,
                vehicleCondition: vehicleCondition,
                receiveDate: formatDateEnglish(receiveDate),
                receiptDate: formatDateEnglish(receiptDate)
            };

            const englishText = e.englishReceiptText(englishData);

            // عرض النصوص
            document.getElementById('arabicReceiptDetails').textContent = arabicText;
            document.getElementById('englishReceiptDetails').textContent = englishText;

            // تعيين التواقيع
            document.getElementById('signatureReceiverName').textContent = receiverName;
            document.getElementById('signatureDate').textContent = formattedReceiptDate;
            document.getElementById('companyRepresentative').textContent = t.companyRepresentative;

            // إظهار منطقة العرض
            document.getElementById('receiptDisplay').style.display = 'block';
            receiptGenerated = true;

            // حفظ البيانات النهائية
            saveData();

            // عرض إشعار النجاح
            const currentT = translations[currentLanguage];
            showAutoSendNotification(currentT.receiptGenerated(currentReceiptNumber), 'success');
        }

        // =============================================
        // حفظ واسترجاع البيانات
        // =============================================

        function saveData() {
            const data = {
                receiverName: document.getElementById('receiverName').value,
                receiptDate: document.getElementById('receiptDate').value,
                receiveDate: document.getElementById('receiveDate').value,
                companyName: document.getElementById('companyName').value,
                vehicleClass: document.getElementById('vehicleClass').value,
                vehicleType: document.getElementById('vehicleType').value,
                manufactureYear: document.getElementById('manufactureYear').value,
                vehicleColor: document.getElementById('vehicleColor').value,
                chassisNumber: document.getElementById('chassisNumber').value,
                plateNumber: document.getElementById('plateNumber').value,
                plateEmirate: document.getElementById('plateEmirate').value,
                vehicleCondition: document.getElementById('vehicleCondition').value
            };

            localStorage.setItem('valenciaReceiptData', JSON.stringify(data));
        }

        function loadSavedData() {
            const savedData = localStorage.getItem('valenciaReceiptData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);

                    document.getElementById('receiverName').value = data.receiverName || '';
                    document.getElementById('receiptDate').value = data.receiptDate || '';
                    document.getElementById('receiveDate').value = data.receiveDate || '';
                    document.getElementById('companyName').value = data.companyName || 'فالنسيا لتجارة الرخام والحجر الطبيعي';
                    document.getElementById('vehicleClass').value = data.vehicleClass || 'فان ركاب';
                    document.getElementById('vehicleType').value = data.vehicleType || 'HYUNDAI STAREX';
                    document.getElementById('manufactureYear').value = data.manufactureYear || '2012';
                    document.getElementById('vehicleColor').value = data.vehicleColor || 'رمادي';
                    document.getElementById('chassisNumber').value = data.chassisNumber || 'KMJWA37KBCU482534';
                    document.getElementById('plateNumber').value = data.plateNumber || 'FF-35715';
                    document.getElementById('plateEmirate').value = data.plateEmirate || '';
                    document.getElementById('vehicleCondition').value = data.vehicleCondition || 'جيدة';
                    
                    // إذا كان هناك اسم مستلم، إنشاء المحضر تلقائياً
                    if (data.receiverName && data.receiverName.trim().length > 2) {
                        setTimeout(() => {
                            autoGenerateReceipt();
                        }, 500);
                    }
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        // إدارة أسماء المستلمين
        function loadSavedReceivers() {
            const saved = localStorage.getItem('valenciaReceivers');
            if (saved) {
                try {
                    savedReceivers = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading receivers list:', e);
                    savedReceivers = [];
                }
            }
        }

        function saveReceivers() {
            localStorage.setItem('valenciaReceivers', JSON.stringify(savedReceivers));
        }

        function addReceiver(name) {
            if (name && name.trim() && !savedReceivers.includes(name.trim())) {
                savedReceivers.push(name.trim());
                saveReceivers();
            }
        }

        // الإدخال التلقائي للمستلمين
        function initReceiverAutocomplete() {
            const input = document.getElementById('receiverName');
            const container = document.createElement('div');
            container.className = 'employee-suggestions';
            container.id = 'receiverSuggestions';
            
            input.parentNode.appendChild(container);

            input.addEventListener('input', function() {
                const query = this.value.trim();
                showReceiverSuggestions(query);
                
                // إذا تم مسح الاسم، إخفاء المحضر
                if (query.length === 0) {
                    document.getElementById('receiptDisplay').style.display = 'none';
                    receiptGenerated = false;
                }
            });

            input.addEventListener('focus', function() {
                if (this.value.trim() === '') {
                    showReceiverSuggestions('');
                }
            });

            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !container.contains(e.target)) {
                    container.style.display = 'none';
                }
            });
        }

        function showReceiverSuggestions(query) {
            const container = document.getElementById('receiverSuggestions');
            let html = '';

            if (query) {
                const filtered = savedReceivers.filter(name => 
                    name.toLowerCase().includes(query.toLowerCase())
                ).slice(0, 5);

                filtered.forEach(name => {
                    html += `<div class="employee-suggestion-item" onclick="selectReceiver('${name}')">${name}</div>`;
                });

                if (!savedReceivers.includes(query) && query.length > 2) {
                    const addText = currentLanguage === 'ar' ? 
                        `إضافة "${query}" كاسم جديد` : 
                        `Add "${query}" as new name`;
                    html += `<div class="employee-suggestion-item new-employee" onclick="addNewReceiver('${query}')">${addText}</div>`;
                }
            } else {
                savedReceivers.slice(0, 5).forEach(name => {
                    html += `<div class="employee-suggestion-item" onclick="selectReceiver('${name}')">${name}</div>`;
                });
            }

            container.innerHTML = html;
            container.style.display = html ? 'block' : 'none';
        }

        function selectReceiver(name) {
            document.getElementById('receiverName').value = name;
            document.getElementById('receiverSuggestions').style.display = 'none';
            saveData();
            
            // إنشاء المحضر تلقائياً بعد اختيار اسم
            setTimeout(() => {
                autoGenerateReceipt();
            }, 100);
        }

        function addNewReceiver(name) {
            document.getElementById('receiverName').value = name;
            addReceiver(name);
            document.getElementById('receiverSuggestions').style.display = 'none';
            saveData();
            
            const t = translations[currentLanguage];
            showAutoSendNotification(t.receiverAdded(name), 'success');
            
            // إنشاء المحضر تلقائياً بعد إضافة الاسم
            setTimeout(() => {
                autoGenerateReceipt();
            }, 100);
        }

        // =============================================
        // دالة طباعة المحضر
        // =============================================

        function printReceipt() {
            if (!receiptGenerated) {
                const t = translations[currentLanguage];
                showAutoSendNotification(t.enterReceiverFirst, 'error');
                document.getElementById('receiverName').focus();
                return;
            }

            // تحديث رأس الطباعة بالبيانات الحالية
            updatePrintHeader();
            
            // تعيين النصوص العربية لرأس الطباعة
            document.getElementById('printCompanyName').textContent = 'فالنسيا لتجارة الرخام والحجر الطبيعي';
            document.getElementById('printCompanySubtitle').textContent = 'شركة مساهمة خاصة - دبي';
            document.getElementById('printDepartment').textContent = 'إدارة النقل والخدمات اللوجستية';
            document.getElementById('printDocumentTitle').textContent = 'محضر استلام سيارة';
            
            // طباعة الصفحة
            window.print();
            
            // إعادة النصوص بعد الطباعة
            setTimeout(() => {
                const t = translations[currentLanguage];
                document.getElementById('printCompanyName').textContent = t.printCompanyName;
                document.getElementById('printCompanySubtitle').textContent = t.printCompanySubtitle;
                document.getElementById('printDepartment').textContent = t.printDepartment;
                document.getElementById('printDocumentTitle').textContent = t.documentTitle;
            }, 100);
        }

        // =============================================
        // دالة تفريغ الحقول
        // =============================================

        function resetForm() {
            const t = translations[currentLanguage];
            if (!receiptGenerated || confirm(t.confirmResetFields)) {
                document.getElementById('receiverName').value = '';
                setDefaultDates();
                document.getElementById('companyName').value = currentLanguage === 'ar' ? 
                    'فالنسيا لتجارة الرخام والحجر الطبيعي' : 
                    'Valencia Marble & Natural Stone Trading Co.';
                document.getElementById('vehicleClass').value = 'فان ركاب';
                document.getElementById('vehicleType').value = 'HYUNDAI STAREX';
                document.getElementById('manufactureYear').value = '2012';
                document.getElementById('vehicleColor').value = 'رمادي';
                document.getElementById('chassisNumber').value = 'KMJWA37KBCU482534';
                document.getElementById('plateNumber').value = 'FF-35715';
                document.getElementById('plateEmirate').value = '';
                document.getElementById('vehicleCondition').value = 'جيدة';
                
                // إخفاء المحضر
                document.getElementById('receiptDisplay').style.display = 'none';
                receiptGenerated = false;
                
                // حفظ البيانات
                saveData();
                
                showAutoSendNotification(t.fieldsCleared, 'success');
            }
        }

        // =============================================
        // دالة إعادة ضبط الترقيم
        // =============================================

        function resetCounter() {
            const t = translations[currentLanguage];
            if (confirm(t.confirmResetCounter)) {
                currentReceiptNumber = 0;
                localStorage.setItem('valenciaReceiptCounter', 1);
                updateReceiptNumber();
                showAutoSendNotification(t.counterReset, 'success');
            }
        }

        // =============================================
        // دوال مساعدة
        // =============================================

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function formatDateEnglish(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function showAutoSendNotification(message, type = 'success') {
            const existingNotification = document.getElementById('auto-send-notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.id = 'auto-send-notification';
            notification.className = type;

            let icon = '';
            if (type === 'success') icon = '<i class="fas fa-check-circle"></i>';
            else if (type === 'error') icon = '<i class="fas fa-exclamation-triangle"></i>';
            else if (type === 'info') icon = '<i class="fas fa-info-circle"></i>';

            notification.innerHTML = icon + message;

            // ضبط الاتجاه بناءً على اللغة
            if (currentLanguage === 'ar') {
                notification.style.textAlign = 'right';
            } else {
                notification.style.textAlign = 'left';
            }

            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'fadeOut 0.5s ease-out';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 500);
                }
            }, 5000);
        }

        // دالة لضبط التوزيع قبل الطباعة
        function adjustPrintLayout() {
            if (!receiptGenerated) return;
            
            // حساب الارتفاع المتاح
            const contentContainer = document.querySelector('.content-container');
            const arabicSection = document.querySelector('.arabic-section');
            const receiptText = document.getElementById('arabicReceiptDetails');
            
            if (contentContainer && arabicSection && receiptText) {
                // تقليل المسافات إذا كان المحتوى طويلاً
                const textHeight = receiptText.scrollHeight;
                const availableHeight = 600; // ارتفاع تقريبي متاح بعد الرأس والتذييل
                
                if (textHeight > availableHeight) {
                    // تقليل حجم الخط للمحتوى الطويل
                    receiptText.style.fontSize = '8.5pt';
                    receiptText.style.lineHeight = '1.3';
                    
                    // تقليل المسافات بين العناصر
                    document.querySelectorAll('.info-row').forEach(row => {
                        row.style.marginBottom = '2px';
                    });
                    
                    document.querySelectorAll('.info-item').forEach(item => {
                        item.style.marginBottom = '1px';
                    });
                }
            }
            
            // تحديث التواريخ في رأس الطباعة
            const printDate = document.getElementById('print-current-date');
            const currentDate = document.getElementById('current-date').textContent;
            if (printDate && currentDate) {
                printDate.textContent = currentDate;
            }
            
            // تحديث رقم المحضر في رأس الطباعة
            const printSerial = document.getElementById('print-serial-number');
            const serialNum = document.getElementById('serial-number').textContent;
            if (printSerial && serialNum) {
                printSerial.textContent = serialNum;
            }
        }

        // تعديل دالة الطباعة لاستدعاء ضبط التوزيع
        function printReceipt() {
            if (!receiptGenerated) {
                const t = translations[currentLanguage];
                showAutoSendNotification(t.enterReceiverFirst, 'error');
                document.getElementById('receiverName').focus();
                return;
            }

            // ضبط التوزيع قبل الطباعة
            adjustPrintLayout();
            
            // تحديث رأس الطباعة بالبيانات الحالية
            updatePrintHeader();
            
            // تعيين النصوص العربية لرأس الطباعة
            document.getElementById('printCompanyName').textContent = 'فالنسيا لتجارة الرخام والحجر الطبيعي';
            document.getElementById('printCompanySubtitle').textContent = 'شركة مساهمة خاصة - دبي';
            document.getElementById('printDepartment').textContent = 'إدارة النقل والخدمات اللوجستية';
            document.getElementById('printDocumentTitle').textContent = 'محضر استلام سيارة';
            
            // إخفاء عناصر غير ضرورية قبل الطباعة
            document.querySelectorAll('.no-print').forEach(el => {
                el.style.display = 'none';
            });
            
            // طباعة الصفحة
            setTimeout(() => {
                window.print();
            }, 100);
            
            // إعادة العناصر المخفية بعد الطباعة
            setTimeout(() => {
                document.querySelectorAll('.no-print').forEach(el => {
                    el.style.display = '';
                });
                
                // إعادة النصوص بعد الطباعة
                const t = translations[currentLanguage];
                document.getElementById('printCompanyName').textContent = t.printCompanyName;
                document.getElementById('printCompanySubtitle').textContent = t.printCompanySubtitle;
                document.getElementById('printDepartment').textContent = t.printDepartment;
                document.getElementById('printDocumentTitle').textContent = t.documentTitle;
            }, 500);
        }
    </script>
</body>
</html>
